<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common::header}"></head>
<body class="d-flex flex-column min-vh-100">
<div class="container-xxl bg-white p-0 d-flex flex-column min-vh-100">
    <div th:replace="~{common::nav}"></div>

    <div class="container-fluid bg-primary wow fadeIn" data-wow-delay="0.1s" style="padding: 35px;">
        <div class="container">
            <div class="row justify-content-center align-items-center g-2">
                <div class="col-md-4 position-relative">
                    <input id="keywordInput" type="text" class="form-control border-0 w-100" placeholder="검색어를 입력하세요..." />
                    <div id="searchResults" class="search-dropdown shadow-sm" style="display: none;"></div>
                </div>
                <div class="col-md-3">
                    <select id="filterSelect" class="form-select border-0 w-100">
                        <option value="all">전체</option>
                        <option value="title">제목</option>
                        <option value="content">내용</option>
                    </select>
                </div>
                <div class="col-md-2 text-center">
                    <button class="btn btn-dark border-0 w-100 fw-bold" onclick="performSearch()">검색</button>
                </div>
            </div>
        </div>
    </div>

    <section class="menu-section flex-grow-1">
        <div class="container-fluid px-0 h-100">
            <div class="row g-0 h-100">
                <div class="col-4 d-flex">
                    <a th:href="@{javaSpring}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">java & spring</a>
                </div>
                <div class="col-4 d-flex">
                    <a th:href="@{linux}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">linux</a>
                </div>
                <div class="col-4 d-flex">
                    <a th:href="@{web}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">web</a>
                </div>
                <div class="col-4 d-flex">
                    <a th:href="@{history}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">history</a>
                </div>
                <div class="col-4 d-flex">
                    <a th:href="@{about}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">about</a>
                </div>
                <div class="col-4 d-flex">
                    <a th:href="@{/etc}" class="btn btn-outline-primary w-100 h-100 rounded-0 d-flex align-items-center justify-content-center fw-bold">etc</a>
                </div>
            </div>
        </div>
    </section>
    <footer th:replace="~{common::footer}"></footer>
</div>
<div th:replace="~{common::script}"></div>
<script>
    let results = [];

    function performSearch() {
        const keyword = document.getElementById('keywordInput').value.trim();
        const filter = document.getElementById('filterSelect').value;
        
        if (!keyword) {
            alert('검색어를 입력해주세요.');
            return;
        }

        // 새로운 검색 시스템으로 리다이렉트
        let searchUrl = `/main-search?keyword=${encodeURIComponent(keyword)}`;
        
        if (filter !== 'all') {
            searchUrl += `&filter=${filter}`;
        }
        
        window.location.href = searchUrl;
    }

    // Enter 키로 검색 실행
    document.getElementById('keywordInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    // 실시간 검색 제안 (선택사항)
    let searchTimeout;
    document.getElementById('keywordInput').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const keyword = this.value.trim();
        
        if (keyword.length >= 2) {
            searchTimeout = setTimeout(() => {
                // 실시간 검색 제안을 위한 API 호출
                fetch(`/api/search/suggest?keyword=${encodeURIComponent(keyword)}`)
                    .then(res => res.json())
                    .then(data => {
                        showSearchSuggestions(data);
                    })
                    .catch(error => console.error('검색 제안 오류:', error));
            }, 300);
        } else {
            document.getElementById('searchResults').style.display = 'none';
        }
    });

    function showSearchSuggestions(suggestions) {
        const container = document.getElementById('searchResults');
        
        if (suggestions && suggestions.length > 0) {
            container.innerHTML = '';
            suggestions.forEach(item => {
                const div = document.createElement('div');
                div.className = 'search-result-item p-2 border-bottom';
                div.style.cursor = 'pointer';
                div.innerHTML = `
                    <div class="fw-bold">${item.title}</div>
                    <small class="text-muted">${item.category} • ${item.author}</small>
                `;
                div.onclick = () => {
                    window.location.href = `/post/${item.id}`;
                };
                container.appendChild(div);
            });
            container.style.display = 'block';
        } else {
            container.style.display = 'none';
        }
    }

    // 검색 결과 외부 클릭 시 드롭다운 숨김
    document.addEventListener('click', function(e) {
        const searchContainer = document.getElementById('searchResults');
        const searchInput = document.getElementById('keywordInput');
        
        if (!searchContainer.contains(e.target) && !searchInput.contains(e.target)) {
            searchContainer.style.display = 'none';
        }
    });
</script>
</body>
</html>


